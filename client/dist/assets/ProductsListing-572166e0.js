import{b as C,j as t,u as D,a as m,L as v,d as Q,e as b,r as a,T as q,E as I,C as P,f as T}from"./index-55c54f2d.js";import{u as j}from"./useElementOnScreen-8bbe7a21.js";import{u as y}from"./useMakeNetworkRequest-bd330b9f.js";import{D as A}from"./Delete-3f5402e5.js";const V=C(t("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");const B=({product:e,products:c,setProducts:i})=>{const l=D(r=>r.auth),{executeServerRequest:s}=y(),n=r=>{s(async()=>{await Q.delete(`/api/products/${r}`);let u=c.filter(d=>d._id!==r);i(u)},[],!0,"Deleted Product")};return t("li",{className:"product-li center",children:m("div",{className:"flex product-container loaded column",children:[l.isAdmin&&m("div",{className:"admin-controls center",children:[t(v,{className:"icon",to:`/edit/${e._id}`,children:t(V,{})}),t("button",{className:"icon",onClick:()=>n(e._id),title:"Delete",children:t(A,{})})]}),m(v,{className:"product-link center column",to:`/product/${e._id}`,children:[t("div",{className:"img-wrapper flex",children:t("img",{className:"product-img",src:e.images[0].url,alt:e.title})}),m("div",{className:"details center",children:[t("span",{className:"text-overflow bold detail flex",children:e.title}),m("span",{className:"detail flex",children:["$ ",e.price]})]})]})]})})};const O=()=>{const e=new URLSearchParams(window.location.search),c=e.get("category"),i=e.get("sleeve"),l=e.get("color"),s=e.get("size"),n=e.get("sort"),r=e.get("min"),u=e.get("max"),d=e.get("search");return`${d?"&title[regex]="+d:""}${c&&c!=="All"?"&category[in]="+c:""}${i?"&sleeve[in]="+i:""}${l?"&color[in]="+l:""}${s?"&size[in]="+s:""}${n?"&"+n:""}${r?"&price[gte]="+r:""}${u?"&[price][lte]="+u:""}`},S=12,J=()=>{const e=b(),c=a.useRef(null),[i,l]=j({root:null,rootMargin:"0px",threshold:1},c),[s,n]=a.useState(null),[r,u]=a.useState(!1),[d,L]=a.useState(!1),[w,E]=a.useState(1),[M,R]=a.useState(""),{executeServerRequest:_,loading:p,error:k}=y(),x=async(o,h,g)=>{let z=`/api/products?page=${g}&limit=${S}&${h}`;_(async()=>{const N=await T.get(z);let $=N.data.products;o.value||a.startTransition(()=>{g===1&&(L(!0),window.scrollTo(0,0)),E(g+1),n(f=>g===1?[...$]:f!==null?[...f,...$]:f),u(N.data.length===S)})})};return a.useEffect(()=>{let o={value:!1},h=O();return R(h),x(o,h,1),()=>{o.value=!0}},[e]),a.useEffect(()=>{l&&!p&&r&&d&&x({value:!1},M,w)},[l]),m("section",{className:"products-list center column",children:[p&&s!==null&&t(q,{}),k&&!p&&!s?t(I,{}):s!==null&&s.length===0?t("h2",{className:"empty-products center",children:"No Match"}):s===null?t(P,{}):t("ul",{className:"products-ul flex",children:s.map(o=>t(B,{product:o,products:s,setProducts:n},o._id))}),r?t("div",{id:"products-progress",className:"center",ref:i,children:t(P,{})}):""]})};export{J as P};
