import{b as z,j as t,u as C,a as m,L as P,d as Q,e as b,r,T as q,C as I,f as T}from"./index-a91e9132.js";import{u as j}from"./useElementOnScreen-e358d2cd.js";import{u as L}from"./useMakeNetworkRequest-975eee34.js";import{D as A}from"./Delete-94309bad.js";import{R as O}from"./RenderFetchedData-09411ff8.js";const V=z(t("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");const B=()=>{const e=new URLSearchParams(window.location.search),c=e.get("category"),i=e.get("sleeve"),n=e.get("color"),s=e.get("size"),o=e.get("sort"),a=e.get("min"),u=e.get("max"),d=e.get("search");return`${d?"&title[regex]="+d:""}${c&&c!=="All"?"&category[in]="+c:""}${i?"&sleeve[in]="+i:""}${n?"&color[in]="+n:""}${s?"&size[in]="+s:""}${o?"&"+o:""}${a?"&price[gte]="+a:""}${u?"&[price][lte]="+u:""}`};const F=({product:e,products:c,setProducts:i})=>{const n=C(a=>a.auth),{executeServerRequest:s}=L(),o=a=>{s(async()=>{await Q.delete(`/api/products/${a}`);let u=c.filter(d=>d._id!==a);i(u)},[],!0,"Deleted Product")};return t("li",{className:"product-li center",children:m("div",{className:"flex product-container loaded column",children:[n.isAdmin&&m("div",{className:"admin-controls center",children:[t(P,{className:"icon",to:`/edit/${e._id}`,children:t(V,{})}),t("button",{className:"icon",onClick:()=>o(e._id),title:"Delete",children:t(A,{})})]}),m(P,{className:"product-link center column",to:`/product/${e._id}`,children:[t("div",{className:"img-wrapper flex",children:t("img",{className:"product-img",src:e.images[0].url,alt:e.title})}),m("div",{className:"details center",children:[t("span",{className:"text-overflow bold detail flex",children:e.title}),m("span",{className:"detail flex",children:["$ ",e.price]})]})]})]})})},S=12,W=()=>{const e=b(),c=r.useRef(null),[i,n]=j({root:null,rootMargin:"0px",threshold:1},c),[s,o]=r.useState(null),[a,u]=r.useState(!1),[d,y]=r.useState(!1),[w,R]=r.useState(1),[M,E]=r.useState(""),{executeServerRequest:D,loading:p,error:_,isOnline:f}=L(),$=async(l,h,g)=>{let k=`/api/products?page=${g}&limit=${S}&${h}`;D(async()=>{const v=await T.get(k);let N=v.data.products;l.value||r.startTransition(()=>{g===1&&(y(!0),window.scrollTo(0,0)),R(g+1),o(x=>g===1?[...N]:x!==null?[...x,...N]:x),u(v.data.length===S)})})};return r.useEffect(()=>{let l={value:!1},h=B();return E(h),$(l,h,1),()=>{l.value=!0}},[e]),r.useEffect(()=>{n&&!p&&a&&d&&$({value:!1},M,w)},[n,f]),m("section",{className:"products-list center column",children:[p&&s!==null&&t(q,{}),t(O,{isLoading:p,isOnline:f,isError:_,emptyResultMessage:"No Match",data:s,children:s&&t("ul",{className:"products-ul flex",children:s.map(l=>t(F,{product:l,products:s,setProducts:o},l._id))})}),a&&f?t("div",{id:"products-progress",className:"center",ref:i,children:t(I,{})}):""]})};export{W as P};
